{
  "version": 3,
  "sources": ["../../quill-image-drop-module/index.js"],
  "sourcesContent": ["/**\r\n * Custom module for quilljs to allow user to drag images from their file system into the editor\r\n * and paste images from clipboard (Works on Chrome, Firefox, Edge, not on Safari)\r\n * @see https://quilljs.com/blog/building-a-custom-module/\r\n */\r\nexport class ImageDrop {\r\n\r\n\t/**\r\n\t * Instantiate the module given a quill instance and any options\r\n\t * @param {Quill} quill\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(quill, options = {}) {\r\n\t\t// save the quill reference\r\n\t\tthis.quill = quill;\r\n\t\t// bind handlers to this instance\r\n\t\tthis.handleDrop = this.handleDrop.bind(this);\r\n\t\tthis.handlePaste = this.handlePaste.bind(this);\r\n\t\t// listen for drop and paste events\r\n\t\tthis.quill.root.addEventListener('drop', this.handleDrop, false);\r\n\t\tthis.quill.root.addEventListener('paste', this.handlePaste, false);\r\n\t}\r\n\r\n\t/**\r\n\t * Handler for drop event to read dropped files from evt.dataTransfer\r\n\t * @param {Event} evt\r\n\t */\r\n\thandleDrop(evt) {\r\n\t\tevt.preventDefault();\r\n\t\tif (evt.dataTransfer && evt.dataTransfer.files && evt.dataTransfer.files.length) {\r\n\t\t\tif (document.caretRangeFromPoint) {\r\n\t\t\t\tconst selection = document.getSelection();\r\n\t\t\t\tconst range = document.caretRangeFromPoint(evt.clientX, evt.clientY);\r\n\t\t\t\tif (selection && range) {\r\n\t\t\t\t\tselection.setBaseAndExtent(range.startContainer, range.startOffset, range.startContainer, range.startOffset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.readFiles(evt.dataTransfer.files, this.insert.bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handler for paste event to read pasted files from evt.clipboardData\r\n\t * @param {Event} evt\r\n\t */\r\n\thandlePaste(evt) {\r\n\t\tif (evt.clipboardData && evt.clipboardData.items && evt.clipboardData.items.length) {\r\n\t\t\tthis.readFiles(evt.clipboardData.items, dataUrl => {\r\n\t\t\t\tconst selection = this.quill.getSelection();\r\n\t\t\t\tif (selection) {\r\n\t\t\t\t\t// we must be in a browser that supports pasting (like Firefox)\r\n\t\t\t\t\t// so it has already been placed into the editor\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// otherwise we wait until after the paste when this.quill.getSelection()\r\n\t\t\t\t\t// will return a valid index\r\n\t\t\t\t\tsetTimeout(() => this.insert(dataUrl), 0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Insert the image into the document at the current cursor position\r\n\t * @param {String} dataUrl  The base64-encoded image URI\r\n\t */\r\n\tinsert(dataUrl) {\r\n\t\tconst index = (this.quill.getSelection() || {}).index || this.quill.getLength();\r\n\t\tthis.quill.insertEmbed(index, 'image', dataUrl, 'user');\r\n\t}\r\n\r\n\t/**\r\n\t * Extract image URIs a list of files from evt.dataTransfer or evt.clipboardData\r\n\t * @param {File[]} files  One or more File objects\r\n\t * @param {Function} callback  A function to send each data URI to\r\n\t */\r\n\treadFiles(files, callback) {\r\n\t\t// check each file for an image\r\n\t\t[].forEach.call(files, file => {\r\n\t\t\tif (!file.type.match(/^image\\/(gif|jpe?g|a?png|svg|webp|bmp|vnd\\.microsoft\\.icon)/i)) {\r\n\t\t\t\t// file is not an image\r\n\t\t\t\t// Note that some file formats such as psd start with image/* but are not readable\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// set up file reader\r\n\t\t\tconst reader = new FileReader();\r\n\t\t\treader.onload = (evt) => {\r\n\t\t\t\tcallback(evt.target.result);\r\n\t\t\t};\r\n\t\t\t// read the clipboard item or file\r\n\t\t\tconst blob = file.getAsFile ? file.getAsFile() : file;\r\n\t\t\tif (blob instanceof Blob) {\r\n\t\t\t\treader.readAsDataURL(blob);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n}\r\n"],
  "mappings": ";;;AAKO,IAAM,YAAN,MAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOtB,YAAY,OAAO,UAAU,CAAC,GAAG;AAEhC,SAAK,QAAQ;AAEb,SAAK,aAAa,KAAK,WAAW,KAAK,IAAI;AAC3C,SAAK,cAAc,KAAK,YAAY,KAAK,IAAI;AAE7C,SAAK,MAAM,KAAK,iBAAiB,QAAQ,KAAK,YAAY,KAAK;AAC/D,SAAK,MAAM,KAAK,iBAAiB,SAAS,KAAK,aAAa,KAAK;AAAA,EAClE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAW,KAAK;AACf,QAAI,eAAe;AACnB,QAAI,IAAI,gBAAgB,IAAI,aAAa,SAAS,IAAI,aAAa,MAAM,QAAQ;AAChF,UAAI,SAAS,qBAAqB;AACjC,cAAM,YAAY,SAAS,aAAa;AACxC,cAAM,QAAQ,SAAS,oBAAoB,IAAI,SAAS,IAAI,OAAO;AACnE,YAAI,aAAa,OAAO;AACvB,oBAAU,iBAAiB,MAAM,gBAAgB,MAAM,aAAa,MAAM,gBAAgB,MAAM,WAAW;AAAA,QAC5G;AAAA,MACD;AACA,WAAK,UAAU,IAAI,aAAa,OAAO,KAAK,OAAO,KAAK,IAAI,CAAC;AAAA,IAC9D;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,YAAY,KAAK;AAChB,QAAI,IAAI,iBAAiB,IAAI,cAAc,SAAS,IAAI,cAAc,MAAM,QAAQ;AACnF,WAAK,UAAU,IAAI,cAAc,OAAO,aAAW;AAClD,cAAM,YAAY,KAAK,MAAM,aAAa;AAC1C,YAAI,WAAW;AAAA,QAGf,OACK;AAGJ,qBAAW,MAAM,KAAK,OAAO,OAAO,GAAG,CAAC;AAAA,QACzC;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAO,SAAS;AACf,UAAM,SAAS,KAAK,MAAM,aAAa,KAAK,CAAC,GAAG,SAAS,KAAK,MAAM,UAAU;AAC9E,SAAK,MAAM,YAAY,OAAO,SAAS,SAAS,MAAM;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,UAAU,OAAO,UAAU;AAE1B,KAAC,EAAE,QAAQ,KAAK,OAAO,UAAQ;AAC9B,UAAI,CAAC,KAAK,KAAK,MAAM,8DAA8D,GAAG;AAGrF;AAAA,MACD;AAEA,YAAM,SAAS,IAAI,WAAW;AAC9B,aAAO,SAAS,CAAC,QAAQ;AACxB,iBAAS,IAAI,OAAO,MAAM;AAAA,MAC3B;AAEA,YAAM,OAAO,KAAK,YAAY,KAAK,UAAU,IAAI;AACjD,UAAI,gBAAgB,MAAM;AACzB,eAAO,cAAc,IAAI;AAAA,MAC1B;AAAA,IACD,CAAC;AAAA,EACF;AAED;",
  "names": []
}
